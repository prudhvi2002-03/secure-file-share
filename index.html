<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cloud Fuze Secure File Share</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container {
      max-width: 850px;
      margin: 40px auto;
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }
    .main-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .main-header img {
      width: 80px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .main-header h1 {
      margin-top: 10px;
      color: #2d3748;
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    label {
      font-weight: 600;
      display: block;
      margin-bottom: 8px;
      color: #2d3748;
    }
    input[type="email"],
    input[type="password"],
    input[type="datetime-local"],
    input[type="file"],
    select,
    textarea {
      width: 100%;
      padding: 12px 16px;
      font-size: 15px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      margin-bottom: 15px;
      transition: all 0.3s ease;
      background: rgba(255,255,255,0.9);
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
    }
    textarea {
      resize: vertical;
      min-height: 100px;
    }
    .card {
      background: rgba(247, 250, 252, 0.8);
      padding: 25px;
      margin-top: 20px;
      border-radius: 16px;
      border: 1px solid rgba(226, 232, 240, 0.5);
      transition: all 0.3s ease;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    .card h3 {
      margin-top: 0;
      color: #4a5568;
      font-size: 18px;
    }
    .toggles .toggle {
      margin-bottom: 15px;
    }
    .toggles input[type="checkbox"] {
      margin-right: 10px;
      transform: scale(1.2);
    }
    .btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 14px 28px;
      margin: 8px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    .btn:active {
      transform: translateY(0);
    }
    .btn-secondary {
      background: linear-gradient(135deg, #48bb78, #38a169);
      box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
    }
    .btn-secondary:hover {
      box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4);
    }
    .btn-danger {
      background: linear-gradient(135deg, #f56565, #e53e3e);
      box-shadow: 0 4px 15px rgba(245, 101, 101, 0.3);
      padding: 8px 16px;
      font-size: 14px;
      margin-top: 10px;
    }
    .btn-danger:hover {
      box-shadow: 0 8px 25px rgba(245, 101, 101, 0.4);
    }
    .share-buttons {
      margin-top: 30px;
      text-align: center;
    }
    #secure-link {
      margin-top: 25px;
      padding: 20px;
      background: rgba(72, 187, 120, 0.1);
      border-radius: 12px;
      border: 1px solid rgba(72, 187, 120, 0.3);
      text-align: center;
    }
    #secure-link a {
      color: #38a169;
      font-weight: 600;
      word-break: break-all;
      text-decoration: none;
    }
    #secure-link a:hover {
      text-decoration: underline;
    }
    #file-info, #selected-file-info {
      font-weight: 500;
      color: #4a5568;
      margin-top: 15px;
      padding: 15px;
      background: rgba(237, 242, 247, 0.8);
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    .cloud-picker {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .status-message {
      padding: 15px;
      margin: 15px 0;
      border-radius: 8px;
      font-weight: 500;
    }
    .status-success {
      background: rgba(72, 187, 120, 0.1);
      color: #38a169;
      border: 1px solid rgba(72, 187, 120, 0.3);
    }
    .status-error {
      background: rgba(245, 101, 101, 0.1);
      color: #e53e3e;
      border: 1px solid rgba(245, 101, 101, 0.3);
    }
    .status-info {
      background: rgba(66, 153, 225, 0.1);
      color: #3182ce;
      border: 1px solid rgba(66, 153, 225, 0.3);
    }
    .email-validation {
      font-size: 12px;
      color: #e53e3e;
      margin-top: -10px;
      margin-bottom: 10px;
    }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
      margin: 10px 0;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      width: 0%;
      transition: width 0.3s ease;
    }
    @media screen and (max-width: 600px) {
      .container {
        margin: 20px;
        padding: 20px;
      }
      .btn {
        width: 100%;
        margin: 8px 0;
      }
      .cloud-picker {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="main-header">
      <img src="https://www.softwareadvice.com/_next/image/?url=https:%2F%2Fgdm-catalog-fmapi-prod.imgix.net%2FProductLogo%2F6c69ed3a-0147-4815-9182-6be37163cfe7.png&w=256&q=75" alt="CloudFuze Logo" />
      <h1>Cloud Fuze Secure File Share</h1>
    </header>

    <div id="status-messages"></div>

    <div>
      <label>To:</label>
      <input type="email" placeholder="Enter recipient email" id="to-email" required />
      <div class="email-validation" id="to-email-error"></div>
    </div>

    <div class="card">
      <h3>üîí Security Settings</h3>
      <p>Your data is automatically encrypted with AES-256 encryption. Configure additional security options below.</p>
      <div class="toggles">
        <div class="toggle">
          <label for="expiry-date">‚è∞ Expiration Date</label>
          <input type="datetime-local" id="expiry-date" />
        </div>
        <div class="toggle">
          <label><input type="checkbox" id="watermarking" /> üè∑Ô∏è Add Watermark to Documents</label>
        </div>
        <div class="toggle">
          <label><input type="checkbox" id="protection" /> üõ°Ô∏è Persistent File Protection</label>
        </div>
        <div class="toggle">
          <label><input type="checkbox" id="download-notification" /> üìß Notify on Download</label>
        </div>
        <div class="toggle">
          <label for="security-password">üîê Security Password (Required for Secure Link)</label>
          <input type="password" id="security-password" placeholder="Enter security password" />
        </div>
      </div>
    </div>

    <div class="card">
      <label for="message">üìù Encrypted Message</label>
      <textarea id="message" rows="4" placeholder="Write a secure message to accompany your file..."></textarea>
    </div>

    <div class="card">
      <h3>üìÅ File Selection</h3>
      <label for="upload-source">Choose Upload Source:</label>
      <select id="upload-source" onchange="toggleFilePicker()">
        <option value="local1">üíª Local Drive 1</option>
        <option value="local2">üü¢ G Drive</option>
        <option value="local3">üü† O Drive</option>
      </select>

      <!-- Local upload sections for each drive -->
      <div id="local-upload-1" class="local-upload" style="display:block;">
        <label for="file-upload-1">Upload File from Local Drive 1</label>
        <input type="file" id="file-upload-1" multiple />
        <div id="file-info-1"></div>
      </div>
      <div id="local-upload-2" class="local-upload" style="display:none;">
        <label for="file-upload-2">Upload File from G Drive</label>
        <input type="file" id="file-upload-2" multiple />
        <div id="file-info-2"></div>
      </div>
      <div id="local-upload-3" class="local-upload" style="display:none;">
        <label for="file-upload-3">Upload File from O Drive</label>
        <input type="file" id="file-upload-3" multiple />
        <div id="file-info-3"></div>
      </div>

      <div class="progress-bar" id="upload-progress" style="display:none;">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
    </div>

    <div class="share-buttons">
      <button class="btn" onclick="handleEmailShare()">üìß SEND VIA EMAIL</button>
      <button class="btn btn-secondary" onclick="generateSecureLink()">üîó GENERATE SECURE LINK</button>
    </div>

    <div id="secure-link"></div>
  </div>

  <script>
    // Global variables
    let selectedFiles = [[], [], []]; // [drive1, drive2, drive3]
    let isValidToEmail = false;
    let isValidFromEmail = false;

    // Email validation
    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    function showEmailValidation(elementId, isValid, message) {
      const errorElement = document.getElementById(elementId);
      errorElement.textContent = isValid ? '' : message;
    }

    // Email input validation
    document.getElementById('to-email').addEventListener('input', function() {
      const email = this.value;
      isValidToEmail = validateEmail(email);
      showEmailValidation('to-email-error', isValidToEmail || email === '', 
        'Please enter a valid email address');
    });

    // File upload handling for each drive
    for (let i = 1; i <= 3; i++) {
      document.getElementById(`file-upload-${i}`).addEventListener("change", function() {
        selectedFiles[i-1] = Array.from(this.files);
        displayFileInfo(i);
      });
    }

    // Update displayFileInfo to include remove buttons
    function displayFileInfo(drive) {
      let files = selectedFiles[drive-1];
      let fileInfoDiv = document.getElementById(`file-info-${drive}`);
      if (files.length > 0) {
        let totalSize = 0;
        let fileList = files.map((file, idx) => {
          totalSize += file.size;
          return `
            üìÑ <strong>${file.name}</strong> (${formatFileSize(file.size)})
            <button class="btn btn-danger" style="padding:2px 8px;font-size:12px;margin-left:8px;" onclick="removeFile(${drive},${idx})">Remove</button>
          `;
        }).join('<br>');
        fileInfoDiv.innerHTML = `
          ${fileList}<br>
          <small>Total: ${files.length} file(s), ${formatFileSize(totalSize)}</small>
        `;
      } else {
        fileInfoDiv.innerHTML = "";
      }
    }

    // Add removeFile function
    function removeFile(drive, idx) {
      selectedFiles[drive-1].splice(idx, 1);
      displayFileInfo(drive);
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // Status messages
    function showStatusMessage(message, type = 'info') {
      const statusDiv = document.getElementById('status-messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `status-message status-${type}`;
      messageDiv.textContent = message;
      statusDiv.appendChild(messageDiv);
      
      setTimeout(() => {
        messageDiv.remove();
      }, 5000);
    }

    // File picker toggle for three drives
    function toggleFilePicker() {
      let source = document.getElementById("upload-source").value;
      for (let i = 1; i <= 3; i++) {
        document.getElementById(`local-upload-${i}`).style.display = (source === `local${i}`) ? "block" : "none";
      }
    }

    // Progress bar simulation
    function showProgress() {
      const progressBar = document.getElementById('upload-progress');
      const progressFill = document.getElementById('progress-fill');
      
      progressBar.style.display = 'block';
      let progress = 0;
      
      const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
          progress = 100;
          clearInterval(interval);
          setTimeout(() => {
            progressBar.style.display = 'none';
            progressFill.style.width = '0%';
          }, 1000);
        }
        progressFill.style.width = progress + '%';
      }, 200);
    }

    // Email sharing
    async function handleEmailShare() {
      const toEmail = document.getElementById("to-email").value;
      const message = document.getElementById("message").value;
      const allFiles = getAllSelectedFiles();

      if (!toEmail) {
        showStatusMessage('Please enter recipient email address', 'error');
        return;
      }
      if (!isValidToEmail) {
        showStatusMessage('Please enter a valid recipient email address', 'error');
        return;
      }
      if (allFiles.length === 0) {
        showStatusMessage('Please select at least one file to share', 'error');
        return;
      }

      showProgress();
      showStatusMessage('Sending email...', 'info');

      const formData = new FormData();
      formData.append('to', toEmail);
      formData.append('message', message);
      allFiles.forEach(file => formData.append('files', file));

      try {
        const response = await fetch('http://localhost:3001/send-email', {
          method: 'POST',
          body: formData
        });
        const result = await response.json();
        if (result.success) {
          showStatusMessage(`‚úÖ Email sent to ${toEmail}!`, 'success');
          document.getElementById("secure-link").innerHTML = `<div class="status-message status-success">Email sent to <strong>${toEmail}</strong>! Check your inbox.</div>`;
        } else {
          showStatusMessage('Failed to send email: ' + result.error, 'error');
        }
      } catch (err) {
        showStatusMessage('Failed to send email: ' + err.message, 'error');
      }
    }

    // Secure link generation
    function generateSecureLink() {
      const password = document.getElementById("security-password").value;
      const allFiles = getAllSelectedFiles();
      if (allFiles.length === 0) {
        showStatusMessage('Please select at least one file to generate a secure link', 'error');
        return;
      }
      if (!password) {
        showStatusMessage('Please enter a security password to generate a secure link', 'error');
        return;
      }
      showProgress();
      showStatusMessage('Generating secure link...', 'info');
      setTimeout(() => {
        const linkId = Math.random().toString(36).substr(2, 12);
        const secureLink = `https://secure.cloudfuze.com/share/${linkId}`;
        const expiry = document.getElementById("expiry-date").value;
        const expiryText = expiry ? new Date(expiry).toLocaleString() : 'No expiration';
        document.getElementById("secure-link").innerHTML = `
          <h4>üîó Secure Link Generated</h4>
          <p><strong>Link:</strong> <a href="${secureLink}" target="_blank">${secureLink}</a></p>
          <p><strong>Password:</strong> <code>${password}</code></p>
          <p><strong>Expires:</strong> ${expiryText}</p>
          <p><small>‚ö†Ô∏è Share this link and password securely. The link will be encrypted and require the password to access.</small></p>
        `;
        showStatusMessage('Secure link generated successfully!', 'success');
        
        // In a real implementation, this would call your backend API
        console.log('Secure link would be generated with:', {
          files: [...selectedFiles, ...cloudFiles],
          password: password,
          expiry: expiry,
          security: {
            watermarking: document.getElementById('watermarking').checked,
            protection: document.getElementById('protection').checked,
            downloadNotification: document.getElementById('download-notification').checked
          }
        });
      }, 2000);
    }

    function getAllSelectedFiles() {
      return selectedFiles.flat();
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Set minimum date to current date
      const now = new Date();
      now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
      document.getElementById('expiry-date').min = now.toISOString().slice(0, 16);
      
      showStatusMessage('Welcome to Cloud Fuze Secure File Share! This is a demonstration version.', 'info');
    });
  </script>
</body>
</html>